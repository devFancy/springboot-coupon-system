# ADR 001: 실용적인 도메인 주도 설계(DDD) 및 JPA 기반의 풍부한 도메인 모델 도입

DATE: 2025.04.29

## 상태 (Status)

Accepted

## 맥락 (Context)

현재 [쿠폰 발급 시스템의 요구사항](../coupon-issue-system-requirement.md)을 분석한 결과, 쿠폰의 생명주기(생성, 발급, 사용, 만료) 관리와 데이터 무결성이 핵심 가치임을 확인했다.

초기 설계 단계에서 '도메인 모델의 순수성(Pure POJO)'과 '개발 생산성' 사이의 트레이드오프를 고려해야 했다.

- 옵션 A (Strict DDD): 도메인 객체와 영속성 객체(JPA Entity)를 완벽히 분리.
   - 장점: 도메인 로직이 프레임워크에 전혀 의존하지 않음.
   - 단점: 두 객체 간의 매핑(Mapping) 코드가 방대해지고, 관리 포인트가 두 배로 늘어남.
- 옵션 B (Pragmatic DDD): JPA Entity 자체가 도메인 모델의 역할을 수행.
   - 장점: 매핑 비용이 없고 코드가 직관적임.
   - 단점: 도메인 계층이 `jakarta.persistence`라는 인프라 기술에 일부 의존하게 됨.

## 결정 (Decision)

우리는 옵션 B (실용적인 DDD)를 채택하여, **JPA Entity 내부에 비즈니스 로직을 포함시키는 '풍부한 도메인 모델'** 전략을 사용한다.

1. JPA Entity와 도메인 모델의 통합:
   - `Coupon`, `IssuedCoupon` 클래스는 `@Entity` 어노테이션을 가지며 데이터베이스 테이블과 매핑된다.
   - 동시에 `validateCouponCreation`, `use`, `updateStatusBasedOnDate`와 같은 핵심 비즈니스 로직을 이 클래스 내부에 캡슐화한다.
   - 단순한 Getter/Setter 사용을 지양하고, 객체의 상태를 변경하는 행위(Method)를 명시적으로 정의한다.

2. 생성자 및 팩토리 메서드를 통한 불변식 보장:
   - 객체 생성 시점에 `validate` 메서드를 강제 호출하여, 유효하지 않은 상태의 쿠폰 객체가 생성되는 것을 원천 차단한다.

## 결과 (Consequences)

긍정적 효과 (Pros)
- 높은 생산성: 도메인 객체와 엔티티 간의 변환 로직을 작성할 필요가 없어 개발 속도가 빠르다.
- 응집도 유지: 데이터(필드)와 데이터를 조작하는 로직(메서드)이 하나의 클래스(`Coupon`)에 존재하여 객체지향적인 설계가 가능하다.
- 빈약한 도메인 모델 방지: 엔티티가 단순히 DB 테이블 매핑용으로 전락하는 것을 막고, 비즈니스 행위의 주체가 된다.

부정적 효과 및 트레이드오프 (Cons)
- 인프라 의존성: 도메인 모듈이 JPA(Hibernate) 기술에 의존하게 된다. 추후 ORM 기술을 변경할 경우 도메인 코드도 수정해야 한다. (하지만 RDB를 사용하는 한 변경 가능성은 낮다고 판단함)
- 테스트 복잡도: 순수 POJO 테스트보다는 약간의 제약이 있을 수 있으나, 비즈니스 로직 자체는 DB 연결 없이 단위 테스트가 가능하다.


## 참고사항 (References)

- [쿠폰 시스템 요구사항 명세](../coupon-issue-system-requirement.md)
- [도메인 모델링 및 용어 사전](../coupon-domain-modeling.md)